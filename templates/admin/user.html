{% extends 'base.html' %}

{% block title %}HealtyMe - Admin{% endblock %}
{% set sidebar = True %}
{% block content %}
        <main class="container my-5">
            <div class="petunjuk-section container-fluid">

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Total Users : {{ informasi.jumlah_user }}   </h2>
                    <i class="fas fa-users fa-3x me-4"></i>
                </div>
    
                <div class="table-responsive mb-3">
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nama</th>
                                <th>Jenis Kelamin</th>
                                <th>Alamat</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in informasi.user %}
                            <tr>
                                <td>{{ user._id }}</td>
                                <td>{{ user.nama }}</td>
                                <td>{{ user.jenis_kelamin }}</td>
                                <td>{{ user.alamat }}</td>
                                <td>
                                    <a class="btn btn-sm btn-danger" onclick="delete_user('{{ user._id }}')">
                                        <i class="fas fa-trash-alt"></i>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function delete_user(user_id) {
        var confirmation = confirm("Apakah Anda yakin ingin menghapus User?");
        
        if (confirmation) {
            $.ajax({
                type: "POST",
                url: "/delete_user/" + user_id,
                data: { user_id: user_id },
                success: function(response) {
                    console.log(response);
                    if (response.success) {
                        updateUserData(response.informasi);

                        alert(response.message);

                        location.reload();
                    } else {
                        alert(response.message);
                    }
                },
                error: function(error) {
                    console.error("Error:", error);
                    alert("Terjadi kesalahan saat menghapus pengguna.");
                }
            });
        }
    }

    function updateUserData(informasi) {
        $('#jumlah_user').text(informasi.jumlah_user);

        var deletedRow = $('[data-user-id="' + informasi.deleted_user_id + '"]');

        deletedRow.remove();
    }
</script>
{% endblock %}